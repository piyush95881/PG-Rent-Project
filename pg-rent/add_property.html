<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Add Property</title>
  <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
</head>
<body class="bg-gray-50 py-10">
  <div class="max-w-2xl mx-auto bg-white p-8 rounded-2xl shadow-md">
    <h2 class="text-2xl font-bold mb-6 text-center">Add New Property</h2>

    <form id="propertyForm" enctype="multipart/form-data" class="space-y-4">

  <!-- Basic Info -->
  <label class="block">
    <span class="block mb-1 font-medium">Property Name</span>
    <input type="text" name="name" required placeholder="Property Name" class="w-full p-3 border rounded-lg">
  </label>

  <label class="block">
    <span class="block mb-1 font-medium">Contact Number</span>
    <input type="text" name="contact" required placeholder="Contact Number" class="w-full p-3 border rounded-lg">
  </label>

  <label class="block">
    <span class="block mb-1 font-medium">City</span>
    <input type="text" name="city" required placeholder="City" class="w-full p-3 border rounded-lg">
  </label>

  <label class="block">
    <span class="block mb-1 font-medium">Address</span>
    <input type="text" name="address" required placeholder="Address" class="w-full p-3 border rounded-lg">
  </label>

  <!-- Rent & Charges -->
  <div>
    <span class="block mb-1 font-medium">Room Rent</span>
    <div class="grid grid-cols-3 gap-2">
      <label class="block">
        <span class="text-sm block mb-1">Single</span>
        <input type="number" name="rent_single" placeholder="Rent - Single" class="p-3 border rounded-lg w-full">
      </label>
      <label class="block">
        <span class="text-sm block mb-1">Double</span>
        <input type="number" name="rent_double" placeholder="Rent - Double" class="p-3 border rounded-lg w-full">
      </label>
      <label class="block">
        <span class="text-sm block mb-1">Triple</span>
        <input type="number" name="rent_triple" placeholder="Rent - Triple" class="p-3 border rounded-lg w-full">
      </label>
    </div>
  </div>

  <label class="block">
    <span class="block mb-1 font-medium">Security Amount</span>
    <input type="number" step="0.01" name="security_amount" placeholder="Security Amount" class="w-full p-3 border rounded-lg">
  </label>

  <label class="block">
    <span class="block mb-1 font-medium">Electricity Rate (per unit)</span>
    <input type="number" step="0.01" name="electricity_rate" placeholder="Electricity Rate (per unit)" class="w-full p-3 border rounded-lg">
  </label>

  <!-- Amenities -->
  <label class="block">
    <span class="block mb-1 font-medium">Amenities (comma separated)</span>
    <input type="text" name="amenities" placeholder="Amenities" class="w-full p-3 border rounded-lg">
  </label>

  <!-- Room Types -->
  <div>
    <span class="block mb-1 font-medium">Room Types</span>
    <div class="grid grid-cols-3 gap-2">
      <label><input type="checkbox" name="room_types" value="single" class="mr-2">Single</label>
      <label><input type="checkbox" name="room_types" value="double" class="mr-2">Double</label>
      <label><input type="checkbox" name="room_types" value="triple" class="mr-2">Triple</label>
    </div>
  </div>

  <!-- Facilities -->
  <div>
    <span class="block mb-1 font-medium">Facilities</span>
    <label class="block"><input type="checkbox" name="furnished" class="mr-2">Furnished</label>
    <label class="block"><input type="checkbox" name="food_included" class="mr-2">Food Included</label>
    <label class="block"><input type="checkbox" name="laundry_available" class="mr-2">Laundry Available</label>
  </div>

  <!-- Availability -->
  <label class="block">
    <span class="block mb-1 font-medium">Available From</span>
    <input type="date" name="available_from" required class="w-full p-3 border rounded-lg">
  </label>

  <label class="block">
    <span class="block mb-1 font-medium">Gender Preference</span>
    <select name="gender_preference" required class="w-full p-3 border rounded-lg">
      <option value="" disabled selected>Select Gender Preference</option>
      <option value="male">Male</option>
      <option value="female">Female</option>
      <option value="any">Any</option>
    </select>
  </label>

  <label class="block">
    <span class="block mb-1 font-medium">Distance from College or Office</span>
    <input type="text" name="distance_from_college_or_office" placeholder="Distance from College/Office" class="w-full p-3 border rounded-lg">
  </label>

  <!-- Files -->
  <label class="block">
    <span class="block mb-1 font-medium">Upload Pictures (max 3, â‰¤1MB each)</span>
    <input type="file" name="pictures" accept="image/*" multiple required class="w-full p-2 border rounded-lg">
  </label>

  <label class="block">
    <span class="block mb-1 font-medium">Upload Government ID (PDF or Image)</span>
    <input type="file" name="government_id" accept=".pdf,image/*" required class="w-full p-2 border rounded-lg">
  </label>

  <!-- Submit -->
  <button type="submit" class="w-full bg-blue-600 text-white py-3 rounded-lg hover:bg-blue-700">Submit</button>

</form>

  </div>

  <script>
    document.getElementById('propertyForm').addEventListener('submit', async function(e) {
      e.preventDefault();
      const form = e.target;
      const formData = new FormData(form);

      // Validate picture limits
      const pictures = formData.getAll('pictures');
      if (pictures.length > 3) {
        alert("You can only upload up to 3 pictures.");
        return;
      }
      for (const pic of pictures) {
        if (pic.size > 1 * 1024 * 1024) {
          alert("Each image must be 1MB or smaller.");
          return;
        }
      }

      // Compose JSON fields
      const rent = {
        single: parseInt(formData.get('rent_single') || 0),
        double: parseInt(formData.get('rent_double') || 0),
        triple: parseInt(formData.get('rent_triple') || 0)
      };
      formData.set('rent', JSON.stringify(rent));

      const roomTypes = {};
      form.querySelectorAll('input[name="room_types"]:checked').forEach(cb => {
        roomTypes[cb.value] = true;
      });
      formData.set('room_types', JSON.stringify(roomTypes));

      const amenities = formData.get('amenities');
      formData.set('amenities', amenities.split(',').map(a => a.trim()));

      // Submit form
      const res = await fetch('/api/upload/properties', {
        method: 'POST',
        body: formData
      });

      if (res.ok) {
        alert('Property added successfully!');
        form.reset();
      } else {
        const err = await res.json();
        alert(`Error: ${err.msg || 'Failed to add property.'}`);
      }
    });
  </script>
</body>
</html>
