<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Add Person</title>
  <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
</head>
<body class="bg-gray-50 py-10">
  <div class="max-w-xl mx-auto bg-white p-8 rounded-2xl shadow-md">
    <h2 class="text-2xl font-bold mb-6 text-center">Add New Person</h2>
    <form id="personForm" enctype="multipart/form-data" class="space-y-4">

  <label class="block">
    <span class="block mb-1 font-medium">Full Name</span>
    <input type="text" name="name" required placeholder="Full Name" class="w-full p-3 border rounded-lg">
  </label>

  <label class="block">
    <span class="block mb-1 font-medium">Age</span>
    <input type="number" name="age" required placeholder="Age" class="w-full p-3 border rounded-lg">
  </label>

  <label class="block">
    <span class="block mb-1 font-medium">Gender</span>
    <select name="gender" required class="w-full p-3 border rounded-lg">
      <option value="" disabled selected>Select Gender</option>
      <option value="Male">Male</option>
      <option value="Female">Female</option>
      <option value="Transgender">Transgender</option>
    </select>
  </label>

  <label class="block">
    <span class="block mb-1 font-medium">Occupation</span>
    <input type="text" name="occupation" placeholder="Occupation (e.g., Student)" class="w-full p-3 border rounded-lg">
  </label>

  <label class="block">
    <span class="block mb-1 font-medium">Budget</span>
    <input type="number" name="budget" placeholder="Budget (INR)" class="w-full p-3 border rounded-lg">
  </label>

  <label class="block">
    <span class="block mb-1 font-medium">Contact Number</span>
    <input type="text" name="contact" required placeholder="Contact Number" class="w-full p-3 border rounded-lg">
  </label>

  <label class="block">
    <span class="block mb-1 font-medium">City</span>
    <input type="text" name="city" required placeholder="City" class="w-full p-3 border rounded-lg">
  </label>

  <label class="block">
    <span class="block mb-1 font-medium">Looking For</span>
    <input type="text" name="looking_for" placeholder="Looking For (e.g. roommate)" class="w-full p-3 border rounded-lg">
  </label>

  <label class="block">
    <span class="block mb-1 font-medium">Hobbies</span>
    <input type="text" name="hobbies" placeholder="Hobbies (comma separated)" class="w-full p-3 border rounded-lg">
  </label>

  <label class="block">
    <span class="block mb-1 font-medium">Short Bio</span>
    <textarea name="description" placeholder="Short Bio" class="w-full p-3 border rounded-lg"></textarea>
  </label>

  <!-- Preferences -->
  <div class="space-y-4">
    <label class="block">
      <span class="block mb-1 font-medium">Smoking Preference</span>
      <select name="smoking" required class="w-full p-3 border rounded-lg">
        <option value="" disabled selected>Select Smoking Preference</option>
        <option value="yes">Yes</option>
        <option value="no">No</option>
      </select>
    </label>

    <label class="block">
      <span class="block mb-1 font-medium">Pet Preference</span>
      <select name="pets" required class="w-full p-3 border rounded-lg">
        <option value="" disabled selected>Select Pet Preference</option>
        <option value="yes">Yes</option>
        <option value="no">No</option>
      </select>
    </label>

    <label class="block">
      <span class="block mb-1 font-medium">Food Preference</span>
      <select name="food" required class="w-full p-3 border rounded-lg">
        <option value="" disabled selected>Select Food Preference</option>
        <option value="veg">Veg</option>
        <option value="non-veg">Non-Veg</option>
        <option value="eggetarian">Eggetarian</option>
      </select>
    </label>
  </div>

  <!-- File Uploads -->
  <div class="space-y-4">
    <label class="block">
      <span class="block mb-1 font-medium">Profile Picture (Max 1MB)</span>
      <input type="file" name="profile_picture" accept="image/*" required class="w-full p-2 border rounded-lg">
    </label>

    <label class="block">
      <span class="block mb-1 font-medium">Government ID (PDF/Image, Max 1MB)</span>
      <input type="file" name="government_id" accept=".pdf,image/*" required class="w-full p-2 border rounded-lg">
    </label>
  </div>

  <button type="submit" class="w-full bg-blue-600 text-white py-3 rounded-lg hover:bg-blue-700">Submit</button>

</form>

  </div>

  <script>
    document.getElementById('personForm').addEventListener('submit', async function (e) {
      e.preventDefault();
      const form = this;
      const formData = new FormData(form);

      // Build preferences JSON string
      const preferences = {
        smoking: formData.get('smoking'),
        pets: formData.get('pets'),
        food: formData.get('food')
      };
      formData.set('preferences', JSON.stringify(preferences));
      formData.delete('smoking');
      formData.delete('pets');
      formData.delete('food');

      // Convert hobbies from string to array
      const hobbies = formData.get('hobbies');
      if (hobbies) {
        formData.set('hobbies', JSON.stringify(hobbies.split(',').map(h => h.trim())));
      }

      try {
        const res = await fetch('/api/upload/people', {
          method: 'POST',
          body: formData
        });

        if (res.ok) {
          alert('Person added successfully!');
          form.reset();
        } else {
          const err = await res.json();
          alert('Error: ' + (err.message || 'Failed to submit'));
        }
      } catch (err) {
        console.error(err);
        alert('Submission failed.');
      }
    });
  </script>
</body>
</html>
